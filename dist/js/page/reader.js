"use strict";define(["jquery","base64","template","text!../../views/content_mod.html","text!../../views/section_mod.html"],function(s,o,i,a,r){var l=window.localStorage,u=l.getItem("chapter_id")||1,d=0;function b(o){s.ajax({url:"/book/data_read?id="+o,dataType:"json",success:function(o){var t,n,c,e=o.jsonp;t=e,n=a,(c=document.createElement("script")).src=t,window.duokan_fiction_chapter=function(o){var t=JSON.parse(s.base64().decode(o));i(n,t,".book_cont"),k&&function(){function o(o){var t=parseInt(s(".book_cont").css("font-size"));l.setItem("font",t),s(".book_cont").css("fontSize",t+o+"px")}k=!1,s(".book_cont").on("click",function(){s(".book_option").show()}),s(".book_option").on("click",function(){s(this).hide()}),s(".style").on("click",function(){var o=s(this).find("dd"),t=s(this).find(".change");return t.toggleClass("icon-eyeoclose").toggleClass("icon-eyeopen"),t.hasClass("icon-eyeopen")?(s(".book_cont").addClass("bg"),o.html("白天")):(s(".book_cont").removeClass("bg"),o.html("夜间")),!1}),s(".cols").on("click",function(){return s(".colsBox").toggle(),!1}),s(".conBg>b").each(function(o,t){s(t).on("click",function(){return s(this).addClass("active").siblings().removeClass("active"),s(".book_cont").css("background",s(this).css("background")),l.setItem("background",s(".book_cont").css("background")),!1})}),s(".bigger").on("click",function(){return o(2),!1}),s(".smaller").on("click",function(){return o(-2),!1}),s.ajax({url:"/book/section",dataType:"json",success:function(o){function t(o){l.setItem("chapter_id",o),u=l.getItem("chapter_id"),s(".num").html(u),b(u)}d=o.item.toc.length,i(r,o.item,".section_list"),s(".list").on("click",function(o){s(".section_list").addClass("show"),o.stopPropagation()}),s(".section_list").on("click","p",function(){s(".section_list").removeClass("show");var o=s(this).data("id");t(o)}),s(".prev_btn").on("click",function(){return--u<=1&&(u=1),t(u),!1}),s(".next_btn").on("click",function(){return d<=++u&&(u=d),t(u),!1}),s(".sections").html('<b class="num">'+u+"</b>/"+d)}}),s(".back").click(function(){return history.go(-1),!1}),s(".book_cont").css("fontSize",l.getItem("font")+"px"),s(".book_cont").css("background",l.getItem("background")),s(".conBg>b").each(function(o,t){s(t).css("background")==l.getItem("background")&&s(t).addClass("active").siblings().removeClass("active")})}(),document.head.removeChild(c)},document.head.appendChild(c)}})}b(u);var k=!0});